/*! library.nyu.edu 2015-08-06 */

!function(a,b){function c(b){return b.map(function(){return this.elements?a.makeArray(this.elements):this}).filter(":input").get()}function d(c){var d,e={};return a.each(c,function(c,f){d=e[f.name],e[f.name]=d===b?f:a.isArray(d)?d.concat(f):[d,f]}),e}var e=Array.prototype.push,f=/^(?:radio|checkbox)$/i,g=/\+/g,h=/^(?:option|select-one|select-multiple)$/i,i=/^(?:button|color|date|datetime|datetime-local|email|hidden|month|number|password|range|reset|search|submit|tel|text|textarea|time|url|week)$/i;a.fn.deserialize=function(j,k){var l,m,n=c(this),o=[];if(!j||!n.length)return this;if(a.isArray(j))o=j;else if(a.isPlainObject(j)){var p,q;for(p in j)a.isArray(q=j[p])?e.apply(o,a.map(q,function(a){return{name:p,value:a}})):e.call(o,{name:p,value:q})}else if("string"==typeof j){var r;for(j=j.split("&"),l=0,m=j.length;m>l;l++)r=j[l].split("="),e.call(o,{name:decodeURIComponent(r[0]),value:decodeURIComponent(r[1].replace(g,"%20"))})}if(!(m=o.length))return this;var s,t,u,v,w,x,y,q,z=a.noop,A=a.noop,B={};for(k=k||{},n=d(n),a.isFunction(k)?A=k:(z=a.isFunction(k.change)?k.change:z,A=a.isFunction(k.complete)?k.complete:A),l=0;m>l;l++)if(s=o[l],w=s.name,q=s.value,(t=n[w])&&(y=(v=t.length)?t[0]:t,y=(y.type||y.nodeName).toLowerCase(),x=null,i.test(y)?(v&&(u=B[w],t=t[B[w]=u==b?0:++u]),z.call(t,t.value=q)):f.test(y)?x="checked":h.test(y)&&(x="selected"),x))for(v||(t=[t],v=1),u=0;v>u;u++)s=t[u],s.value==q&&z.call(s,(s[x]=!0)&&q);return A.call(this),this}}(jQuery),$(function(){var a=$(".section__search"),b=$(".table"),c=b.find("tbody"),d=b.find("th"),e=$(".section__search__reset"),f=$(".pagination"),g=function(a){var b,c,d={};if(""===a)return{};for(b=0;b<a.length;b+=1)c=a[b].split("="),2===c.length&&(d[c[0]]=decodeURIComponent(c[1].replace(/\+/g," ")));return d},h=function(a){return a.replace(/[^a-zA-Z0-9]+/gi,"-").replace(/^\-|\-$/gi,"").toLowerCase()},i=function(){return a.find(":input").filter(function(){return!!$(this).val()&&$(this).val()!=$(this).attr("data-default")}).serialize()},j=function(){p(),e.toggleClass("is-hidden",!i());var d=g(a.serialize().split("&"));d.engine_key=swiftypeEngineKey,d.per_page=pageSize,d.sort_field={page:d.sort_field},d.sort_direction={page:d.sort_direction};var f=b.attr("data-collection"),h=f?{collection:f}:{};a.find("select").each(function(){$(this).val()&&(h[$(this).attr("name")]=$(this).val())}),d.filters={page:h},b.addClass("is-loading"),$.ajax({url:"https://api.swiftype.com/api/v1/public/engines/search.json",data:d,dataType:"json",method:"POST",success:k}).fail(function(){c.html(n('Could not load results. <a href="">Try again?</a>'))}).always(function(){b.removeClass("is-loading")})},k=function(a){c.html(""),$.each(a.records,function(a,b){b.length>0?$.each(b,function(a,b){l(b).appendTo(c)}):c.html(n('No results found. <a href="?">Reset filters?</a>'))}),o(a.info)},l=function(a,b){var c=$('<tr class="table__row">');return d.each(function(){var b=$(this).data("field"),d=$('<td class="table__cell">').append(m(a,b));c.append(d)}),c},m=function(a,b){return value=a[b],value?"title"==b&&a.card_html?a.card_html:"departments"==b?("string"==typeof value&&(value=[value]),$.map(value,function(a){return $('<a href="/'+b+"/"+h(a)+'"></a>').text(a)[0].outerHTML}).join(", ")):"service,space,location".indexOf(b)>-1?$('<a href="/'+b+"s/"+h(value)+'"></a>').text(value):("string"==typeof value&&(value=[value]),value.join(", ")):""},n=function(a){return'<tr class="table__row empty"><td class="table__cell" colspan="'+d.length+'">'+a+"</td></tr>"},o=function(a){var b,c=-1;$.each(a,function(a,d){d.num_pages>c&&(b=a,c=d.num_pages)});var d=a[b].current_page,e=a[b].num_pages;if(f.html(""),e>1){if(d>1){var g=d-1;f.append('<a href="?page='+g+'" class="pagination__prev ss-left" data-page="'+g+'">Previous</a>')}for(g=1;e>=g;g++)f.append($('<a href="?page='+g+'" class="pagination__link" data-page="'+g+'">'+g+"</a>").toggleClass("is-selected",d==g));if(e>d){var g=d+1;f.append('<a href="?page='+g+'" class="pagination__next ss-right right" data-page="'+g+'">Next</a>')}}},p=function(){var b=a.find("input[name=sort_field]").val(),c=a.find("input[name=sort_direction]").val();d.removeAttr("data-sort"),d.filter("[data-field="+b+"]").attr("data-sort",c)},q=function(){before=a.serialize(),a.trigger("reset").deserialize(location.search.substr(1)),after=a.serialize(),before!=after&&j(),Stretchy.resizeAll()};a.on("submit",function(a){a.preventDefault();var b=i();history.pushState({popstate:!0},"",b?"?"+b:location.pathname),j()}),a.find(":input").on("change",function(b){a.find("input[name=page]").val(1),a.trigger("submit")}),b.find(".table__cell--sortable").on("click",function(){var b="asc"==$(this).attr("data-sort")?"desc":"asc";a.find("input[name=page]").val(1),a.find("input[name=sort_field]").val($(this).attr("data-field")),a.find("input[name=sort_direction]").val(b),a.trigger("submit")}),e.on("click",function(b){b.preventDefault(),a.trigger("reset").trigger("submit"),Stretchy.resizeAll()}),f.on("click","a",function(c){c.preventDefault(),a.find("input[name=page]").val($(this).attr("data-page")),a.trigger("submit"),$("html, body").animate({scrollTop:b.offset().top},500)}),window.onpopstate=function(a){q()},location.search.length>1&&q()});
//# sourceMappingURL=collection.min.js.map